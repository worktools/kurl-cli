# kurl 技术规格和设计思路

本文档记录 `kurl` 项目的技术选型和初期设计决策.

## 1. 核心目标

创建一个与 `curl` 用法兼容的命令行工具, 但提供更详尽、更易于调试的输出信息. 尤其在网络请求的各个阶段 (如 DNS 解析, TLS 握手, HTTP 请求头等) 提供深入洞察.

## 2. 技术选型

### 2.1. 语言: Rust

选择 Rust 是因为它具有内存安全、高性能和出色的并发处理能力, 非常适合构建可靠的网络工具. 其强大的生态系统也为我们提供了高质量的库.

### 2.2. 命令行参数解析: `clap`

`curl` 有大量复杂的命令行参数. 为了高效、准确地解析这些参数, 我们选择 `clap` (Command Line Argument Parser).

- **优点**:
    - **功能强大**: 支持子命令、各种参数形式、自动生成帮助信息 (`--help`) 和版本信息 (`--version`).
    - **声明式**: 使用结构体和属性宏 (derive) 来定义参数, 代码清晰且易于维护.
    - **高度兼容**: 能够轻松模仿 `curl` 的参数风格.

### 2.3. HTTP 客户端: `reqwest`

`reqwest` 是 Rust 中最流行的高级 HTTP 客户端库.

- **优点**:
    - **功能全面**: 内置支持 HTTPS, Cookies, JSON, 异步 (async/await) 等.
    - **易于使用**: 提供了简洁的 API, 能轻松发起各类 HTTP 请求.
    - **可扩展性**: 底层基于 `hyper`, 性能可靠, 并且允许进行深度定制以满足我们的调试需求.

### 2.4. 异步运行时: `tokio`

`reqwest` 是一个异步库, 需要一个异步运行时来驱动. `tokio` 是 Rust 社区最成熟、功能最丰富的异步运行时.

- **优点**:
    - **生态系统**: 与 `reqwest` 和其他众多网络库无缝集成.
    - **高性能**: 提供了高效的 I/O 操作和任务调度.

### 2.5. 日志和调试信息: `log` + `env_logger` + `clap-verbosity-flag`

为了实现 `-v`, `-vv`, `-vvv` 这样的多级详细输出, 我们采用以下组合:

- **`log`**: 一个通用的日志记录 Facade, 让我们的库可以与不同的日志实现解耦.
- **`env_logger`**: `log` 的一个常用实现, 可以通过环境变量或代码配置日志级别.
- **`clap-verbosity-flag`**: 一个 `clap` 的辅助库, 可以轻松地将 `-v` 标志的数量映射到 `log` 的日志级别 (e.g., `-v` -> `info`, `-vv` -> `debug`, `-vvv` -> `trace`). 这完美契合了我们的需求.

## 3. 初期实现计划

1.  **参数定义**: 在 `clap` 中定义一个基础的 `Cli` 结构体, 包含一个必须的 `url` 参数和可选的 `-v` (verbose) 标志.
2.  **日志初始化**: 在 `main` 函数中, 根据用户提供的 `-v` 标志数量初始化 `env_logger`.
3.  **发起请求**: 使用 `reqwest` 发起一个简单的 GET 请求到指定的 URL.
4.  **打印信息**:
    - 使用 `log::debug!`, `log::info!` 等宏在请求的不同阶段打印调试信息.
    - 将收到的 HTTP 响应体 (response body) 打印到标准输出 (stdout), 模仿 `curl` 的默认行为.
5.  **验证**: 编译并通过 `kurl https://example.com` 与 `curl https://example.com` 的输出进行对比. 同时测试 `kurl --help` 和 `kurl -vvv ...` 的行为.
